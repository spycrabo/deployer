# Deployer

Инструмент для автоматизации процесса развертывания проектов на серверах.

Проект состоит из двух исполняемых файлов:

- **api** - HTTP-сервер, принимающий вебхуки и отправляющий задачи в очередь
- **runner** - исполнитель задач из очереди

## Описание конфигурационного файла

Конфигурационный файл должен быть в формате YAML, может храниться в любой директории и иметь любое имя.
Конфиг передается в оба исполняемых файла через флаг `-c`.

Ниже представлено описание всех возможных опций конфига.

##### server

Информация для HTTP-сервера.

##### server.port

Порт, на котором будет запущен HTTP-сервер.

##### webhooks

Список вебхуков, которые будет обрабатывать HTTP-сервер.

##### webhooks.[name]

Имя вебхука. Должно быть уникальным.

##### webhooks.[name].path

Путь, по которому будет доступен вебхук.

##### webhooks.[name].validators

Список валидаторов, которые будут применены к вебхуку.

Доступные валидаторы:

**gitlab** - проверяет, что вебхук пришел
от [GitLab](https://docs.gitlab.com/ee/user/project/integrations/webhooks.html):

- **gitlab.token** - секретный токен, который должен быть указан в настройках вебхука в GitLab

##### webhooks.[name].tasks

Задачи, которые будут помещаться в очередь при выполнении вебхука.

##### runner

Конфигурация для исполнителя задач.

##### runner.dir

Если указан, то исполнитель будет использовать директорию для обработки очереди.

- **dir.path** - путь к директории

##### tasks

Список задач, которые могут быть выполнены.

##### tasks.[name]

Имя задачи. Должно быть уникальным.

##### tasks.[name].command

Команда, которая будет исполнена при выполнении задачи.

##### tasks.[name].dir

Если указан, то исполнитель будет использовать директорию для выполнения задачи.

##### tasks.[name].notifications

Тексты уведомлений, которые будут отправлены в чат при выполнении задачи.

##### tasks.[name].notifications.success

Текст уведомления, которое будет отправлено в чат при успешном выполнении задачи.

##### tasks.[name].notifications.failure

Текст уведомления, которое будет отправлено в чат при неуспешном выполнении задачи.

##### notifiers

Список каналов уведомлений о выполнении задач.

Доступные каналы:

**telegram** - данные бота для отправки уведомлений в Telegram:

- **telegram.botToken** - токен бота
- **telegram.chatId** - идентификатор чата
- **telegram.params** - дополнительные параметры, которые нужно добавить в тело
  запроса [sendMessage](https://core.telegram.org/bots/api#sendmessage)
